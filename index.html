<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grid Generator</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Password Entry Screen -->
    <div id="password-screen">
        <div class="container">
            <h1>Password Protected</h1>
            <input type="password" id="password" placeholder="Enter password">
            <button id="submit-password-btn">Submit</button>
            <p id="error-message" style="color: red;"></p>
        </div>
    </div>

    <!-- Cohort Population Entry Screen -->
    <div id="input-screen" style="display: none;">
        <div class="container">
            <h1>Cohort Populations</h1>
            <form id="cohort-form" onsubmit="generateFormation(event)">
                <label for="PPP">PPP:</label>
                <input type="number" id="PPP" min="0">

                <label for="L1">L1:</label>
                <input type="number" id="L1" min="0">

                <label for="CC">CC:</label>
                <input type="number" id="CC" min="0">

                <label for="L2">L2:</label>
                <input type="number" id="L2" min="0">

                <label for="L3">L3:</label>
                <input type="number" id="L3" min="0">

                <label for="L4">L4:</label>
                <input type="number" id="L4" min="0">

                <label for="L5">L5:</label>
                <input type="number" id="L5" min="0">

                <label for="L6">L6:</label>
                <input type="number" id="L6" min="0">

                <button type="submit">Generate Formation</button>
            </form>
        </div>
    </div>

    <!-- Generated Grid Display Screen -->
    <div id="grid-screen" style="display: none;">
        <div class="container">
            <h1>Generated Grid</h1>
            <div id="grid-output"></div>
            <button onclick="location.reload()">Reset</button>
        </div>
    </div>

    <script>
        // Password Validation
        const correctPassword = "yourPassword"; // Define correct password

        // Attach event listener to the submit button
        document.getElementById("submit-password-btn").addEventListener("click", function() {
            const passwordInput = document.getElementById("password").value;
            const errorMessage = document.getElementById("error-message");
            
            if (passwordInput === correctPassword) {
                // Show input screen and hide password screen
                document.getElementById("password-screen").style.display = "none";
                document.getElementById("input-screen").style.display = "block";
                errorMessage.textContent = "";
            } else {
                errorMessage.textContent = "Incorrect password. Please try again.";
            }
        });

        // Function to handle cohort population form submission
        function generateFormation(event) {
            event.preventDefault(); // Prevent the form from submitting

            const cohorts = {
                L1: parseInt(document.getElementById("L1").value) || 0,
                L2: parseInt(document.getElementById("L2").value) || 0,
                L3: parseInt(document.getElementById("L3").value) || 0,
                L6: parseInt(document.getElementById("L6").value) || 0,
                L5: parseInt(document.getElementById("L5").value) || 0,
                L4: parseInt(document.getElementById("L4").value) || 0,
                CC: parseInt(document.getElementById("CC").value) || 0,
                PPP: parseInt(document.getElementById("PPP").value) || 0,
            };

            const columns = 8;
            const totalPeople = Object.values(cohorts).reduce((a, b) => a + b, 0);
            const rows = Math.ceil(totalPeople / columns);
            const totalCells = rows * columns;

            // Create empty grid
            let grid = Array.from({ length: rows }, () => Array(columns).fill("EMPTY"));

            // Determine PPP placement
            const pppRows = Math.ceil(cohorts.PPP / columns);
            const pppStartRow = rows - pppRows;
            let remainingPPP = cohorts.PPP;

            for (let row = pppStartRow; row < rows; row++) {
                for (let col = 0; col < columns; col++) {
                    if (remainingPPP > 0) {
                        grid[row][col] = "PPP";
                        remainingPPP--;
                    }
                }
            }

            // Place CC above PPP
            let remainingCC = cohorts.CC;
            const ccRow = pppStartRow - 1;

            for (let col = 0; col < columns; col++) {
                if (remainingCC > 0) {
                    grid[ccRow][col] = "CC";
                    remainingCC--;
                }
            }

            // Helper function for cohort placement
            function assignCohort(cohort, count, col1, col2, stopRow) {
                for (let row = 0; row < stopRow; row++) {
                    if (count <= 0) break;

                    if (grid[row][col1] === "EMPTY") {
                        grid[row][col1] = cohort;
                        count--;
                    }
                    if (count > 0 && grid[row][col2] === "EMPTY") {
                        grid[row][col2] = cohort;
                        count--;
                    }
                }
                return count;
            }

            // Place primary cohorts
            cohorts.L1 = assignCohort("L1", cohorts.L1, 3, 4, rows);
            cohorts.L2 = assignCohort("L2", cohorts.L2, 2, 5, rows);
            cohorts.L3 = assignCohort("L3", cohorts.L3, 1, 6, rows);
            cohorts.L6 = assignCohort("L6", cohorts.L6, 0, 7, rows);

            // Place L5 directly after L6
            let remainingL5 = cohorts.L5;

            for (let row = 0; row < ccRow; row++) {
                if (remainingL5 <= 0) break;

                if (grid[row][0] === "EMPTY") {
                    grid[row][0] = "L5";
                    remainingL5--;
                }
                if (remainingL5 > 0 && grid[row][7] === "EMPTY") {
                    grid[row][7] = "L5";
                    remainingL5--;
                }
            }

            // Fill remaining L5 slots
            for (let row = 0; row < ccRow; row++) {
                if (remainingL5 <= 0) break;

                if (grid[row][1] === "EMPTY") {
                    grid[row][1] = "L5";
                    remainingL5--;
                }
                if (remainingL5 > 0 && grid[row][6] === "EMPTY") {
                    grid[row][6] = "L5";
                    remainingL5--;
                }
            }

            // Place L4 in remaining empty slots
            let remainingL4 = cohorts.L4;

            for (let row = 0; row < rows; row++) {
                for (let col = 1; col < columns - 1; col++) {
                    if (remainingL4 <= 0) break;

                    if (grid[row][col] === "EMPTY") {
                        grid[row][col] = "L4";
                        remainingL4--;
                    }
                }
            }

            // Secondary pass for L4
            for (let row = 0; row < rows; row++) {
                for (let col = 0; col < columns; col++) {
                    if (remainingL4 <= 0) break;

                    if (grid[row][col] === "EMPTY") {
                        grid[row][col] = "L4";
                        remainingL4--;
                    }
                }
            }

            // Adjust last PPP row
            for (let col = 0; col < columns; col++) {
                if (grid[rows - 1][col] === "L4" || grid[rows - 1][col] === "L5") {
                    for (let swapRow = pppStartRow; swapRow < rows; swapRow++) {
                        grid[swapRow][col] = "EMPTY";
                    }
                    break;
                }
            }

            grid.reverse(); // Reverse the grid for display

            // Display the grid
            const gridOutput = document.getElementById("grid-output");
            gridOutput.innerHTML = "<pre>" + JSON.stringify(grid, null, 2) + "</pre>";

            // Hide the input screen and show the grid screen
            document.getElementById("input-screen").style.display = "none";
            document.getElementById("grid-screen").style.display = "block";
        }
    </script>
</body>
</html>
